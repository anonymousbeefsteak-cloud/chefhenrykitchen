<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Henry's Kitchen - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,400..900&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'bodoni': ['"Bodoni Moda"', 'serif'],
              'roboto': ['"Roboto"', 'sans-serif'],
            },
            colors: {
              'colore-uno': '#f7f6f5',
              'colore-due': '#bcb5b1',
              'colore-tre': '#77726c',
              'colore-quattro': '#202123',
              'colore-cinque': '#cb334f',
              'colore-nove': '#821427',
            }
          }
        }
      }
    </script>
    <style>
        body { background-color: #f7f6f5; font-family: 'Roboto', sans-serif; }
        .sidebar-link { @apply flex items-center p-3 my-1 text-gray-200 rounded-lg hover:bg-colore-nove hover:text-white transition-colors duration-200; }
        .sidebar-link.active { @apply bg-colore-cinque text-white; }
        .stat-card { @apply bg-white p-6 rounded-xl shadow-md transition-transform hover:-translate-y-1; }
        .status-select { @apply bg-transparent font-semibold border-none rounded-lg focus:ring-0; }
        .status-select-pending { @apply text-yellow-800; }
        .status-select-confirmed { @apply text-blue-800; }
        .status-select-completed { @apply text-green-800; }
        .status-select-cancelled { @apply text-red-800; }
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
        }
        #toast.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -20px);
        }
        #toast.success { background-color: #28a745; }
        #toast.error { background-color: #dc3545; }
        .status-badge {
            @apply px-2 py-1 rounded-full text-xs font-semibold;
        }
        .status-pending { @apply bg-yellow-100 text-yellow-800; }
        .status-confirmed { @apply bg-blue-100 text-blue-800; }
        .status-completed { @apply bg-green-100 text-green-800; }
        .status-cancelled { @apply bg-red-100 text-red-800; }
    </style>
</head>
<body class="bg-colore-uno text-colore-quattro">

    <div id="auth-overlay" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center w-full max-w-sm">
            <h2 class="text-2xl font-bodoni mb-4">Admin Access</h2>
            <p class="mb-4 text-colore-tre">Please enter the password to continue.</p>
            <input type="password" id="password-input" class="w-full p-2 border border-gray-300 rounded mb-4 focus:ring-2 focus:ring-colore-cinque focus:border-transparent" placeholder="Password">
            <button id="login-btn" class="w-full bg-colore-cinque text-white py-2 rounded-lg hover:bg-colore-nove transition-colors">Login</button>
            <p id="auth-error" class="text-red-500 text-sm mt-2 hidden">Incorrect password.</p>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <div class="flex h-screen">
            <aside class="w-64 bg-colore-quattro text-white flex-col hidden md:flex">
                <div class="p-6 text-center border-b border-gray-700">
                    <h1 class="text-2xl font-bodoni">Henry's Kitchen</h1>
                    <p class="text-sm text-colore-due">Admin Panel</p>
                </div>
                <nav class="flex-grow p-4">
                    <a href="#dashboard" class="sidebar-link active" data-view="dashboard">
                        <i class="fas fa-tachometer-alt w-8 text-center"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#orders" class="sidebar-link" data-view="orders">
                        <i class="fas fa-receipt w-8 text-center"></i>
                        <span>Orders</span>
                    </a>
                    <a href="#menu" class="sidebar-link" data-view="menu">
                        <i class="fas fa-utensils w-8 text-center"></i>
                        <span>Menu</span>
                    </a>
                    <a href="#reservations" class="sidebar-link opacity-50 cursor-not-allowed" title="Coming Soon" onclick="event.preventDefault()">
                        <i class="fas fa-calendar-check w-8 text-center"></i>
                        <span>Reservations</span>
                    </a>
                </nav>
                <div class="p-4 border-t border-gray-700">
                    <a href="/" target="_blank" class="flex items-center p-3 text-gray-300 hover:text-white transition-colors">
                        <i class="fas fa-sign-out-alt w-8 text-center"></i>
                        <span>View Live Site</span>
                    </a>
                </div>
            </aside>

            <main class="flex-1 flex flex-col">
                 <header class="p-4 bg-white shadow-md flex md:hidden justify-between items-center">
                     <h1 class="text-xl font-bodoni">HK Admin</h1>
                     <button id="mobile-menu-btn" class="text-2xl"><i class="fas fa-bars"></i></button>
                 </header>
                 <div id="view-content" class="flex-1 p-4 sm:p-8 overflow-y-auto">
                    <!-- Views will be rendered here -->
                 </div>
            </main>
        </div>
    </div>
    
    <div id="toast"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz5m6PuueTv4OcabjS9fabmL3XnRQ_qcwjBavcHRiQjxRY68MXaCxh-EyK243aRVohy/exec';
        const ADMIN_PASSWORD = 'henry2024';

        const app = {
            state: {
                orders: [],
                filteredOrders: [],
                menuItems: [],
                view: 'dashboard',
            },

            init() {
                this.cacheDOMElements();
                this.setupEventListeners();
                this.checkAuth();
            },

            cacheDOMElements() {
                this.dom = {
                    authOverlay: document.getElementById('auth-overlay'),
                    passwordInput: document.getElementById('password-input'),
                    loginBtn: document.getElementById('login-btn'),
                    authError: document.getElementById('auth-error'),
                    appContainer: document.getElementById('app-container'),
                    viewContent: document.getElementById('view-content'),
                    sidebarLinks: document.querySelectorAll('.sidebar-link'),
                    toast: document.getElementById('toast'),
                    mobileMenuBtn: document.getElementById('mobile-menu-btn'),
                };
            },

            setupEventListeners() {
                this.dom.loginBtn.addEventListener('click', () => this.handleLogin());
                this.dom.passwordInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleLogin();
                });

                window.addEventListener('hashchange', () => this.handleRouteChange());
                this.dom.sidebarLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        if (e.currentTarget.classList.contains('cursor-not-allowed')) {
                            e.preventDefault();
                            return;
                        }
                        this.state.view = e.currentTarget.dataset.view;
                        this.render();
                    });
                });

                if (this.dom.mobileMenuBtn) {
                    this.dom.mobileMenuBtn.addEventListener('click', () => this.toggleMobileMenu());
                }
            },

            checkAuth() {
                if (sessionStorage.getItem('hk_admin_auth') === 'true') {
                    this.dom.authOverlay.style.display = 'none';
                    this.dom.appContainer.style.display = 'block';
                    this.handleRouteChange();
                    this.api.fetchOrders();
                    this.loadMenuItems();
                }
            },

            handleLogin() {
                if (this.dom.passwordInput.value === ADMIN_PASSWORD) {
                    sessionStorage.setItem('hk_admin_auth', 'true');
                    this.dom.authOverlay.style.display = 'none';
                    this.dom.appContainer.classList.remove('hidden');
                    this.handleRouteChange();
                    this.api.fetchOrders();
                    this.loadMenuItems();
                } else {
                    this.dom.authError.classList.remove('hidden');
                    this.dom.passwordInput.focus();
                }
            },

            handleRouteChange() {
                const hash = window.location.hash.replace('#', '') || 'dashboard';
                this.state.view = hash;
                this.render();
            },

            showToast(message, type = 'success') {
                this.dom.toast.textContent = message;
                this.dom.toast.className = type;
                this.dom.toast.classList.add('show');
                setTimeout(() => {
                    this.dom.toast.classList.remove('show');
                }, 3000);
            },
            
            formatDate(dateString) {
                if (!dateString) return 'N/A';
                try {
                    return new Date(dateString).toLocaleString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric', 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        hour12: true 
                    });
                } catch (e) { 
                    return dateString; 
                }
            },

            render() {
                this.dom.sidebarLinks.forEach(link => {
                    link.classList.toggle('active', link.dataset.view === this.state.view);
                });

                switch (this.state.view) {
                    case 'orders':
                        this.renderOrdersView();
                        break;
                    case 'menu':
                        this.renderMenuView();
                        break;
                    case 'dashboard':
                    default:
                        this.renderDashboardView();
                        break;
                }
            },

            renderDashboardView() {
                if (!this.state.orders.length) {
                    this.dom.viewContent.innerHTML = `
                        <div class="text-center p-10">
                            <i class="fas fa-spinner fa-spin text-3xl text-colore-cinque mb-4"></i>
                            <p class="text-colore-tre">Loading orders...</p>
                        </div>`;
                    return;
                }

                const totalRevenue = this.state.orders.reduce((sum, order) => sum + (Number(order['Total Amount']) || 0), 0);
                const pendingOrders = this.state.orders.filter(o => (o.Status || 'Pending').toLowerCase() === 'pending').length;
                const recentOrders = this.state.orders.slice(0, 5);

                const recentOrdersHtml = recentOrders.map(order => {
                    const status = (order.Status || 'Pending').toLowerCase();
                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-3 font-medium">${order['Order ID'] || 'N/A'}</td>
                            <td class="p-3">${order['Customer Name'] || 'Unknown'}</td>
                            <td class="p-3 font-semibold text-right">$${(Number(order['Total Amount']) || 0).toFixed(2)}</td>
                            <td class="p-3 text-right">
                                <span class="status-badge status-${status}">${order.Status || 'Pending'}</span>
                            </td>
                        </tr>
                    `;
                }).join('');

                this.dom.viewContent.innerHTML = `
                    <h2 class="text-3xl font-bodoni mb-6">Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="stat-card">
                            <h3 class="text-colore-tre">Total Revenue</h3>
                            <p class="text-3xl font-bold mt-2">$${totalRevenue.toFixed(2)}</p>
                        </div>
                        <div class="stat-card">
                            <h3 class="text-colore-tre">Total Orders</h3>
                            <p class="text-3xl font-bold mt-2">${this.state.orders.length}</p>
                        </div>
                        <div class="stat-card">
                            <h3 class="text-colore-tre">Pending Orders</h3>
                            <p class="text-3xl font-bold mt-2">${pendingOrders}</p>
                        </div>
                    </div>
                    <h3 class="text-2xl font-bodoni mb-4">Recent Orders</h3>
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-3 text-left font-semibold">Order ID</th>
                                    <th class="p-3 text-left font-semibold">Customer</th>
                                    <th class="p-3 text-right font-semibold">Total</th>
                                    <th class="p-3 text-right font-semibold">Status</th>
                                </tr>
                            </thead>
                            <tbody>${recentOrdersHtml}</tbody>
                        </table>
                    </div>
                `;
            },
            
            renderOrdersView() {
                const ordersToDisplay = this.state.filteredOrders.length > 0 ? this.state.filteredOrders : this.state.orders;
                
                const ordersHtml = ordersToDisplay.map(order => {
                    const status = (order.Status || 'Pending').toLowerCase();
                    const statusOptions = ['Pending', 'Confirmed', 'Completed', 'Cancelled']
                        .map(s => `<option value="${s}" ${s.toLowerCase() === status ? 'selected' : ''}>${s}</option>`).join('');

                    const orderItems = (order['Order Items'] || '')
                        .split(';')
                        .filter(item => item.trim())
                        .map(item => `<div class="text-xs text-gray-600 mb-1">${item.trim()}</div>`)
                        .join('');

                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-4 font-medium">${order['Order ID'] || 'N/A'}</td>
                            <td class="p-4">
                                <div class="font-semibold">${order['Customer Name'] || 'Unknown'}</div>
                                <div class="text-xs text-gray-500">${order['Email'] || 'No email'}</div>
                                <div class="text-xs text-gray-500">${order['Phone'] || 'No phone'}</div>
                            </td>
                            <td class="p-4">${this.formatDate(order['Pickup Time'])}</td>
                            <td class="p-4 max-w-xs">${orderItems || 'No items'}</td>
                            <td class="p-4 font-bold text-right">$${(Number(order['Total Amount']) || 0).toFixed(2)}</td>
                            <td class="p-4">
                                <select class="status-select status-select-${status}" data-order-id="${order['Order ID']}">
                                    ${statusOptions}
                                </select>
                            </td>
                        </tr>
                    `;
                }).join('');

                this.dom.viewContent.innerHTML = `
                    <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                        <h2 class="text-3xl font-bodoni">Orders</h2>
                        <input type="text" id="search-orders" class="p-2 border border-gray-300 rounded-lg w-full sm:w-64" placeholder="Search by name or ID...">
                    </div>
                    <div class="bg-white rounded-xl shadow-md overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="p-4 text-left font-semibold">Order ID</th>
                                    <th class="p-4 text-left font-semibold">Customer</th>
                                    <th class="p-4 text-left font-semibold">Pickup Time</th>
                                    <th class="p-4 text-left font-semibold">Items</th>
                                    <th class="p-4 text-right font-semibold">Total</th>
                                    <th class="p-4 text-left font-semibold">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${!ordersToDisplay.length ? 
                                    `<tr><td colspan="6" class="p-8 text-center text-gray-500">No orders found.</td></tr>` : 
                                    ordersHtml
                                }
                            </tbody>
                        </table>
                    </div>
                `;
                
                // Add search functionality
                const searchInput = document.getElementById('search-orders');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => this.handleSearch(e.target.value));
                }
                
                // Add status change listeners
                this.dom.viewContent.querySelectorAll('.status-select').forEach(sel => {
                    sel.addEventListener('change', (e) => {
                        const newStatus = e.target.value;
                        const orderId = e.target.dataset.orderId;
                        this.api.updateOrderStatus(orderId, newStatus);
                        e.target.className = `status-select status-select-${newStatus.toLowerCase()}`;
                    });
                });
            },

            renderMenuView() {
                const menuCategories = this.groupMenuItemsByCategory();
                
                const menuHtml = Object.keys(menuCategories).map(category => {
                    const itemsHtml = menuCategories[category].map(item => `
                        <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                            <div class="flex flex-col md:flex-row gap-4">
                                <div class="md:w-1/3">
                                    <img src="${item.image}" alt="${item.name}" class="w-full h-48 object-cover rounded-lg">
                                </div>
                                <div class="md:w-2/3">
                                    <div class="flex justify-between items-start mb-2">
                                        <h3 class="text-xl font-bodoni font-semibold">${item.name}</h3>
                                        <span class="text-lg font-bold text-colore-cinque">$${item.price}</span>
                                    </div>
                                    <p class="text-gray-600 mb-4">${item.description}</p>
                                    <div class="flex flex-wrap gap-2">
                                        ${item.category ? `<span class="bg-colore-uno text-colore-tre px-3 py-1 rounded-full text-sm">${item.category}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    return `
                        <div class="mb-8">
                            <h2 class="text-2xl font-bodoni mb-4 text-colore-quattro border-b pb-2">${category}</h2>
                            <div class="grid grid-cols-1 gap-6">
                                ${itemsHtml}
                            </div>
                        </div>
                    `;
                }).join('');

                this.dom.viewContent.innerHTML = `
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-3xl font-bodoni">Menu Management</h2>
                        <button class="bg-colore-cinque text-white px-4 py-2 rounded-lg hover:bg-colore-nove transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Item
                        </button>
                    </div>
                    ${menuHtml}
                `;
            },

            groupMenuItemsByCategory() {
                const categories = {};
                this.state.menuItems.forEach(item => {
                    if (!categories[item.category]) {
                        categories[item.category] = [];
                    }
                    categories[item.category].push(item);
                });
                return categories;
            },

            handleSearch(query) {
                const lowerQuery = query.toLowerCase();
                this.state.filteredOrders = this.state.orders.filter(order => {
                    return (order['Customer Name']?.toLowerCase().includes(lowerQuery) ||
                           (order['Order ID']?.toLowerCase().includes(lowerQuery)));
                });
                this.renderOrdersView();
            },

            loadMenuItems() {
                // Sample menu data with proper image URLs
                this.state.menuItems = [
                    // Bread & Soups
                    {
                        name: "HOME MADE BREAD",
                        price: "4.95",
                        description: "Focaccia with balsamic reduction & extra virgin olive oil, whipped butter",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/bread-1920w.jpg"
                    },
                    {
                        name: "GARLIC BREAD",
                        price: "4.95",
                        description: "Sliced home made crusty french bread toasted with garlic butter",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/garlic-1920w.jpg"
                    },
                    {
                        name: "PORK RILLETTES AND BREAD",
                        price: "6.95",
                        description: "A rustic French pork pâté spread (brown pork jam) with homemade bread",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/pork+pate+bread-1920w.jpg"
                    },
                    {
                        name: "TOMATO CHEESE BREAD",
                        price: "8.95",
                        description: "Tomato marinaram sauce, mazzarella & parmesan cheese melted on focaccia bread",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/tomato+bread-1920w.jpg"
                    },
                    {
                        name: "FRENCH ONION SOUP",
                        price: "18.00",
                        description: "Classic French onion soup with cheese crust",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/onion-soup-ff70c88d-1920w.jpg"
                    },
                    {
                        name: "SEAFOOD CHOWDER",
                        price: "18.00",
                        description: "Rich and creamy seafood chowder",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/chowder-a2521c66-1920w.jpg"
                    },
                    {
                        name: "LOBSTER BISQUE",
                        price: "24.00",
                        description: "With lobster arancini",
                        category: "BREAD & SOUPS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/lobster-bisq-1920w.jpg"
                    },

                    // Appetizer & Salad
                    {
                        name: "HOUSE SALAD",
                        price: "14.95-16.95",
                        description: "Spring mix and crisp romaine lettuce tossed with our house dressing and balsamic reduction",
                        category: "APPETIZER & SALAD",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/hou.salad-1920w.jpg"
                    },
                    {
                        name: "CAESAR SALAD",
                        price: "14.95-16.95",
                        description: "Crisp romaine lettuce with homemade Caesar dressing, parmesan cheese and homemade garlic crouton",
                        category: "APPETIZER & SALAD",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/ceaser-1920w.jpg"
                    },
                    {
                        name: "SALMON GRAVLAX",
                        price: "18.00",
                        description: "With orange fennel salad",
                        category: "APPETIZER & SALAD",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/samoln+G-1920w.jpg"
                    },
                    {
                        name: "MUSHROOM FRICASSEE",
                        price: "18.00",
                        description: "Sautéed assorted mushrooms on baby spinach salad with balsamic reduction & walnuts",
                        category: "APPETIZER & SALAD",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/mushroom-Fri-1920w.jpg"
                    },
                    {
                        name: "BAKED GOAT CHEESE SALAD",
                        price: "18.00",
                        description: "With pistachio crust on spinach, pear & mixed berry salad",
                        category: "APPETIZER & SALAD",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/GOAT-CHEESE-d558f8b1-afba1750-1920w.jpg"
                    },
                    {
                        name: "BEEF CARPACCIO",
                        price: "28.00",
                        description: "Dressed with Dijon mustard, lemon, capers, parmigigiano, truffle oil",
                        category: "APPETIZER & SALAD",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/beef-carpio-1920w.jpg"
                    },

                    // Hot Appetizers
                    {
                        name: "ESCARGOTS A LA PARISIENNE",
                        price: "18.00",
                        description: "Baked snails in a cognac, garlic, & herb butter",
                        category: "HOT APPETIZERS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/ecsago-a9f326c4-1920w.jpg"
                    },
                    {
                        name: "SIGNATURE CRAB CAKE",
                        price: "18.00",
                        description: "Served on avocado, tomato salsa, mango coulis & wasabi aioli",
                        category: "HOT APPETIZERS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/carb+cake-1920w.jpg"
                    },
                    {
                        name: "FROG LEGS FEUILLETTES",
                        price: "28.00",
                        description: "Sautéed with mushroom & Riesling cream sauce served in a flaky puff pastry",
                        category: "HOT APPETIZERS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/frog+legs-1920w.jpg"
                    },
                    {
                        name: "ROASTED QUAIL & FOIE GRAS",
                        price: "28.00",
                        description: "Roasted quail stuffed with wild rice, mushroom & foie gras, wrapped in prosciutto",
                        category: "HOT APPETIZERS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/quail+app-1920w.jpg"
                    },
                    {
                        name: "CRISP PRAWNS WRAPPED IN ANGEL HAIR",
                        price: "18.00",
                        description: "Served on carrot raisin salad with mango salsa",
                        category: "HOT APPETIZERS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/crisp-prawns-c7f0c313-1920w.jpg"
                    },

                    // The Classic Art of Pasta
                    {
                        name: "PENNE POMODORO",
                        price: "30.00",
                        description: "With Italian plum tomatoes and fresh basil",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/tom-1920w.jpg"
                    },
                    {
                        name: "PENNE ALFREDO",
                        price: "30.00",
                        description: "Tossed in a rich parmigiano cheese cream sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/cream-1920w.jpg"
                    },
                    {
                        name: "LINGUINE CARBONARA",
                        price: "32.00",
                        description: "With pancetta, parmesan cheese, and custard cream sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/caro-pasta-1920w.jpg"
                    },
                    {
                        name: "LINGUINE POLLO PESTO",
                        price: "32.00",
                        description: "With chicken tossed in fresh basil pesto cream sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/pesto-1920w.jpg"
                    },
                    {
                        name: "LINGUINE SALMON AFFUMICATO",
                        price: "35.00",
                        description: "With smoked salmon and sun-dried tomatoes in a light cream sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/salmon-pasta-1920w.jpg"
                    },
                    {
                        name: "LINGUINE AGLIO OLIO",
                        price: "30.00",
                        description: "With garlic, chili, white wine, butter, basil, parsley, and extra virgin olive oil",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/aliolo-6d7b7ab1-1920w.jpg"
                    },
                    {
                        name: "LINGUINE AMATRICIANA",
                        price: "32.00",
                        description: "With pancetta, garlic, shallot, chili, spicy tomatoes sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/AM-8032bb9b-1920w.jpg"
                    },
                    {
                        name: "LINGUINE SALSICCIA",
                        price: "32.00",
                        description: "With sautéed Italian sausage in spicy tomato sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/sausage-1920w.jpg"
                    },
                    {
                        name: "LINGUINE PESCATORA",
                        price: "35.00",
                        description: "With mussels, prawns, scallops, clams, and calamari in spicy tomato sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/seafood+pasta-1920w.jpg"
                    },
                    {
                        name: "LINGUINE VONGOLE",
                        price: "35.00",
                        description: "With clam in garlic, chili, white wine & extra virgin olive oil",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/clam-1920w.jpg"
                    },
                    {
                        name: "LINGUINE GAMBERONI",
                        price: "35.00",
                        description: "With sautéed prawns in tomato Rosé sauce",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/ling+PARWNS-1920w.jpg"
                    },
                    {
                        name: "RISOTTO FUNGHI",
                        price: "35.00",
                        description: "With a medley of portobellini, shiitake & shimeji mushroom, aromatics with truffle oil",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/RISOTO-funghi-1920w.jpg"
                    },
                    {
                        name: "RISOTTO DUCK",
                        price: "38.00",
                        description: "Smoked Duck Breast with artichokes, sun dried tomatoes, peas and parmigiano cheese",
                        category: "THE CLASSIC ART OF PASTA",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/risoto-duck-1920w.jpg"
                    },

                    // Chef's Recommended
                    {
                        name: "BOUILLABAISSE MARSEILLAISE",
                        price: "68.00",
                        description: "A medley of fish & shell fish cooked in aromatic fish soup served with rouille sauce & garlic crouton",
                        category: "CHEF'S RECOMMENDED",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/bouiabsa-6c0226f0-1920w.jpg"
                    },
                    {
                        name: "PANSERED RED SNAPPER",
                        price: "38.00",
                        description: "Mushroom vermouth sauce",
                        category: "CHEF'S RECOMMENDED",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/snapper-1920w.jpg"
                    },
                    {
                        name: "BAKED BLACK SABLE FISH",
                        price: "48.00",
                        description: "With Olive Tapenade, Tomato confit, capers and lemon infused olive oil",
                        category: "CHEF'S RECOMMENDED",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/sable-1920w.jpg"
                    },

                    // Henry's Specialties
                    {
                        name: "BEEF BOURGUIGNON",
                        price: "38.00",
                        description: "Braised beef shank in a tasty rich burgundy wine with mushrooms & onions",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/beef+stew-1920w.jpg"
                    },
                    {
                        name: "DUCK BREAST",
                        price: "42.00",
                        description: "Roasted to your preference in a Grand Marnier orange sauce",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/duck+brest-1920w.jpg"
                    },
                    {
                        name: "BEEF WELLINGTON",
                        price: "65.00",
                        description: "Tenderloin of beef wrapped with prosciutto, foie gras purée, mushroom & truffle duxelle",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/wellington-1920w.jpg"
                    },
                    {
                        name: "RACK OF LAMB",
                        price: "65.00",
                        description: "With a Provençale herbs crust and rosemary jus",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/lamb-1920w.jpg"
                    },
                    {
                        name: "PORK MEDALLION",
                        price: "38.00",
                        description: "With caramelized apple & blue cheese",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/pork+cut-1920w.jpg"
                    },
                    {
                        name: "ROAST CHICKEN",
                        price: "38.00",
                        description: "Succulent boneless free range chicken marinated in lemon garlic & rosemary",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/roast+chix-585accf2-1920w.jpg"
                    },
                    {
                        name: "ROASTED RABBIT SADDLE ROULADE",
                        price: "45.00",
                        description: "Wrapped with proscuitto and wild morel mushroom",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/rabbit-1920w.jpg"
                    },
                    {
                        name: "PORK KNUCKLE",
                        price: "38.00",
                        description: "Roasted cracking pork hock with sauerkraut",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/pork-Kn-1920w.jpg"
                    },
                    {
                        name: "VEAL T-BONE",
                        price: "48.00",
                        description: "Grilled Veal T-Bone rubbed with garlic, lemon juice rosemary & ex virgin olive oil",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/T+bone-2f1e27c1-1920w.jpg"
                    },
                    {
                        name: "CASSOULET TOULOUSE",
                        price: "38.00",
                        description: "A hearty French bean stew, baked with duck confit, sausage, and pork",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/casslout+2-1920w.jpg"
                    },
                    {
                        name: "DUCK CONFIT PERIGOURDINE",
                        price: "38.00",
                        description: "Traditional slow cooked duck leg with sautéed mushroom, foie gars mousse madeira wine & truffle jus",
                        category: "HENRY'S SPECIALTIES",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/DUCK+CONFIT-d1436af0-1920w.jpg"
                    },

                    // Homemade Desserts
                    {
                        name: "SIGNATURE CHEESE CAKE",
                        price: "15.00",
                        description: "With brandied blueberries",
                        category: "HOMEMADE DESSERTS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/cheese+cake-1920w.jpg"
                    },
                    {
                        name: "CHOCOLATE GANACHE",
                        price: "15.00",
                        description: "Kahlua and chocolate mousse glazed with shiny ganache",
                        category: "HOMEMADE DESSERTS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/chcoc-cake-1920w.jpg"
                    },
                    {
                        name: "CRÈME BRULÉE",
                        price: "15.00",
                        description: "Crisp caramelized vanilla cream custard with berries (Not available for take-out)",
                        category: "HOMEMADE DESSERTS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/crebe-4c7616e9-1920w.jpg"
                    },
                    {
                        name: "LEMON TART",
                        price: "15.00",
                        description: "With meringue and berries",
                        category: "HOMEMADE DESSERTS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/lomon+t-1920w.jpg"
                    },
                    {
                        name: "FRUITS SHERBET",
                        price: "15.00",
                        description: "Refreshing fruit sherbet",
                        category: "HOMEMADE DESSERTS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/SHERBET-6ccd5d65-1920w.jpg"
                    },
                    {
                        name: "NOUGAT GLACEE",
                        price: "15.00",
                        description: "Nougat ice cream with almond, pistachios",
                        category: "HOMEMADE DESSERTS",
                        image: "https://lirp.cdn-website.com/0015f2f5/dms3rep/multi/opt/ice+cream+2-1920w.jpg"
                    }
                ];
            },

            toggleMobileMenu() {
                const sidebar = document.querySelector('aside');
                sidebar.classList.toggle('hidden');
            },

            api: {
                async fetchOrders() {
                    try {
                        const response = await fetch(`${SCRIPT_URL}?action=getOrders`);
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const result = await response.json();
                        if (result.status === 'error') throw new Error(result.message);
                        app.state.orders = result.data || [];
                        app.state.filteredOrders = result.data || [];
                        app.render();
                    } catch (e) {
                        console.error('Error fetching orders:', e);
                        app.showToast(`Error fetching orders: ${e.message}`, 'error');
                        app.state.orders = [];
                        app.state.filteredOrders = [];
                        app.render();
                    }
                },

                async updateOrderStatus(orderId, newStatus) {
                    try {
                        const formData = new FormData();
                        formData.append('action', 'updateStatus');
                        formData.append('orderId', orderId);
                        formData.append('status', newStatus);

                        const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        const result = await response.json();
                        if (result.status === 'error') throw new Error(result.message);
                        
                        // Update local state to reflect change immediately
                        const order = app.state.orders.find(o => o['Order ID'] === orderId);
                        if (order) order.Status = newStatus;
                        
                        app.showToast(`Order ${orderId} updated to ${newStatus}`, 'success');
                    } catch (e) {
                        console.error('Error updating order:', e);
                        app.showToast(`Failed to update order: ${e.message}`, 'error');
                        // Re-fetch to revert optimistic update on failure
                        this.fetchOrders();
                    }
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
